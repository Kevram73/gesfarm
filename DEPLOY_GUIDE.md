# üöÄ Guide de D√©ploiement GESFARM sur Vercel

## üìã Pr√©requis

- ‚úÖ Compte Vercel
- ‚úÖ Base de donn√©es externe (PlanetScale, Railway, Supabase)
- ‚úÖ Node.js install√©
- ‚úÖ Vercel CLI install√©

## üîß √âtape 1: Pr√©paration

### 1.1 Installation de Vercel CLI
```bash
npm install -g vercel
```

### 1.2 Connexion √† Vercel
```bash
vercel login
```

### 1.3 G√©n√©ration de la cl√© d'application
```bash
php artisan key:generate --show
```
**‚ö†Ô∏è IMPORTANT**: Copiez cette cl√©, vous en aurez besoin pour la configuration Vercel.

## üóÑÔ∏è √âtape 2: Configuration de la Base de Donn√©es

### Option A: PlanetScale (Recommand√©)
1. Cr√©ez un compte sur [PlanetScale](https://planetscale.com)
2. Cr√©ez une nouvelle base de donn√©es
3. Notez les credentials :
   - Host: `aws.connect.psdb.cloud`
   - Database: `votre-nom-db`
   - Username: `votre-username`
   - Password: `votre-password`

### Option B: Railway
1. Cr√©ez un compte sur [Railway](https://railway.app)
2. Cr√©ez un service MySQL
3. Copiez les credentials depuis le dashboard

### Option C: Supabase
1. Cr√©ez un compte sur [Supabase](https://supabase.com)
2. Cr√©ez un nouveau projet
3. Utilisez les credentials PostgreSQL

## üöÄ √âtape 3: D√©ploiement

### M√©thode 1: Script PowerShell (Windows)
```powershell
.\deploy-vercel.ps1
```

### M√©thode 2: Script Bash (Linux/Mac)
```bash
chmod +x deploy-vercel.sh
./deploy-vercel.sh
```

### M√©thode 3: Manuel
```bash
# Installer les d√©pendances
composer install --no-dev --optimize-autoloader

# Optimiser l'application
php artisan config:cache
php artisan route:cache
php artisan view:cache

# D√©ployer
vercel --prod
```

## ‚öôÔ∏è √âtape 4: Configuration des Variables d'Environnement

Dans le dashboard Vercel, ajoutez ces variables :

### Variables Obligatoires
```bash
APP_NAME=GESFARM
APP_ENV=production
APP_KEY=base64:votre-cl√©-g√©n√©r√©e-ici
APP_DEBUG=false
APP_URL=https://votre-app.vercel.app

DB_CONNECTION=mysql
DB_HOST=votre-h√¥te-base-de-donn√©es
DB_PORT=3306
DB_DATABASE=votre-nom-base-de-donn√©es
DB_USERNAME=votre-utilisateur
DB_PASSWORD=votre-mot-de-passe

CACHE_DRIVER=array
SESSION_DRIVER=array
QUEUE_CONNECTION=sync
MAIL_MAILER=log
```

### Variables CORS
```bash
SANCTUM_STATEFUL_DOMAINS=localhost,127.0.0.1,localhost:3000,localhost:3001,gesfarm-frontend.vercel.app
SESSION_DOMAIN=null
```

## üóÉÔ∏è √âtape 5: Migrations et Seeders

### 5.1 R√©cup√©rer les variables d'environnement
```bash
vercel env pull .env.local
```

### 5.2 Ex√©cuter les migrations
```bash
php artisan migrate --force
```

### 5.3 Ex√©cuter les seeders (optionnel)
```bash
php artisan db:seed --force
```

## üß™ √âtape 6: Test de l'API

### 6.1 Test de base
```bash
curl https://votre-app.vercel.app/api/
```

### 6.2 Test CORS
```powershell
.\test-vercel-cors.ps1 -ApiUrl "https://votre-app.vercel.app" -FrontendUrl "https://gesfarm-frontend.vercel.app"
```

### 6.3 Test d'authentification
```bash
curl -X POST https://votre-app.vercel.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password"}'
```

## üîó √âtape 7: Mise √† Jour du Frontend

Mettez √† jour l'URL de l'API dans votre frontend Next.js :

```typescript
// lib/services/api.ts
const baseURL = "https://votre-app.vercel.app/api"
```

## üìä √âtape 8: Monitoring

### 8.1 Logs Vercel
```bash
vercel logs
vercel logs --follow
```

### 8.2 M√©triques
- Dashboard Vercel > Analytics
- Dashboard Vercel > Functions

## üõ†Ô∏è Configuration CORS Avanc√©e

### Middleware CORS Personnalis√©
Le projet inclut un middleware CORS personnalis√© (`VercelCorsMiddleware`) qui :
- ‚úÖ G√®re les requ√™tes preflight OPTIONS
- ‚úÖ Autorise les origines sp√©cifiques
- ‚úÖ Supporte les credentials
- ‚úÖ Optimis√© pour Vercel

### Configuration dans vercel.json
```json
{
  "headers": [
    {
      "source": "/api/(.*)",
      "headers": [
        {
          "key": "Access-Control-Allow-Origin",
          "value": "https://gesfarm-frontend.vercel.app"
        },
        {
          "key": "Access-Control-Allow-Methods",
          "value": "GET, POST, PUT, PATCH, DELETE, OPTIONS"
        },
        {
          "key": "Access-Control-Allow-Headers",
          "value": "Content-Type, Accept, Authorization, X-Requested-With, Application, X-CSRF-TOKEN"
        },
        {
          "key": "Access-Control-Allow-Credentials",
          "value": "true"
        }
      ]
    }
  ]
}
```

## üÜò D√©pannage

### Erreur 500
1. V√©rifiez les logs Vercel : `vercel logs`
2. V√©rifiez les variables d'environnement
3. V√©rifiez la connexion √† la base de donn√©es

### Erreur CORS
1. V√©rifiez la configuration CORS dans `config/cors.php`
2. V√©rifiez le middleware `VercelCorsMiddleware`
3. V√©rifiez les headers dans `vercel.json`
4. Testez avec le script `test-vercel-cors.ps1`

### Timeout
1. Optimisez vos requ√™tes
2. R√©duisez la complexit√© des op√©rations
3. Utilisez le cache quand possible

### Base de donn√©es
1. V√©rifiez les credentials
2. V√©rifiez la connectivit√©
3. V√©rifiez les migrations

## üìà Optimisations

### Performance
- ‚úÖ Cache des configurations Laravel
- ‚úÖ Cache des routes
- ‚úÖ Cache des vues
- ‚úÖ Optimisation des d√©pendances Composer

### S√©curit√©
- ‚úÖ Variables d'environnement s√©curis√©es
- ‚úÖ CORS configur√© correctement
- ‚úÖ Headers de s√©curit√©
- ‚úÖ Authentification Sanctum

### Monitoring
- ‚úÖ Logs centralis√©s
- ‚úÖ M√©triques de performance
- ‚úÖ Alertes d'erreur

## üéØ URLs Finales

Apr√®s d√©ploiement :
- **API Backend** : `https://votre-app.vercel.app/api/`
- **Frontend** : `https://gesfarm-frontend.vercel.app`
- **Documentation API** : `https://votre-app.vercel.app/api/documentation`

## ‚úÖ Checklist de D√©ploiement

- [ ] Vercel CLI install√© et connect√©
- [ ] Base de donn√©es externe configur√©e
- [ ] Cl√© d'application g√©n√©r√©e
- [ ] Variables d'environnement configur√©es dans Vercel
- [ ] Code d√©ploy√© sur Vercel
- [ ] Migrations ex√©cut√©es
- [ ] API test√©e
- [ ] CORS test√©
- [ ] Frontend mis √† jour
- [ ] Monitoring configur√©

## üéâ F√©licitations !

Votre API GESFARM est maintenant d√©ploy√©e sur Vercel avec une gestion CORS compl√®te !

### Prochaines √©tapes :
1. D√©ployez votre frontend Next.js sur Vercel
2. Configurez le monitoring
3. Mettez en place les alertes
4. Optimisez les performances
