# üö® Correction CORS - GESFARM

## ‚úÖ **Corrections Appliqu√©es**

### **1. Configuration CORS Simplifi√©e**
```php
// config/cors.php
'allowed_origins' => ['*'],
'allowed_methods' => ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],
'allowed_headers' => ['*'],
'supports_credentials' => true,
```

### **2. Middleware CORS Standard**
- ‚úÖ Utilisation du middleware CORS de Laravel (`\Illuminate\Http\Middleware\HandleCors::class`)
- ‚úÖ Suppression du middleware personnalis√© qui causait des conflits

### **3. Configuration Frontend**
```typescript
// lib/services/api.ts
baseURL: "http://62.171.181.213/api"
withCredentials: true
```

---

## üöÄ **Actions Requises**

### **1. Red√©marrer les Conteneurs**
```bash
cd C:\Users\LENOVO\Documents\codes\gesfarm
docker-compose restart
```

### **2. Nettoyer le Cache Laravel**
```bash
docker-compose exec app php artisan config:clear
docker-compose exec app php artisan cache:clear
docker-compose exec app php artisan route:clear
```

### **3. Tester CORS**
```bash
# Ex√©cuter le test simple
chmod +x test-cors-simple.sh
./test-cors-simple.sh
```

---

## üîç **V√©rification**

### **Test Manuel avec cURL**
```bash
curl -X OPTIONS \
  -H "Origin: http://62.171.181.213:3000" \
  -H "Access-Control-Request-Method: POST" \
  -H "Access-Control-Request-Headers: Content-Type,Authorization" \
  -v \
  "http://62.171.181.213/api/login"
```

### **R√©ponse Attendue**
```
HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, PUT, PATCH, DELETE, OPTIONS
Access-Control-Allow-Headers: *
Access-Control-Allow-Credentials: true
Access-Control-Max-Age: 86400
```

---

## üö® **Si CORS Ne Fonctionne Toujours Pas**

### **1. V√©rifier les Logs**
```bash
docker-compose logs app | grep -i cors
```

### **2. V√©rifier la Configuration**
```bash
docker-compose exec app php artisan config:show cors
```

### **3. V√©rifier les Routes**
```bash
docker-compose exec app php artisan route:list | grep api
```

### **4. Test Direct de l'API**
```bash
curl -X GET "http://62.171.181.213/api/dashboard" -H "Accept: application/json"
```

---

## üìã **Checklist de V√©rification**

- [ ] ‚úÖ Configuration CORS mise √† jour (`allowed_origins: ['*']`)
- [ ] ‚úÖ Middleware CORS standard utilis√©
- [ ] ‚úÖ Middleware personnalis√© supprim√©
- [ ] ‚úÖ Conteneurs red√©marr√©s
- [ ] ‚úÖ Cache Laravel nettoy√©
- [ ] ‚úÖ Test CORS r√©ussi

---

## üîß **Configuration Finale**

### **Backend (Laravel)**
- **URL API** : `http://62.171.181.213/api`
- **CORS** : Permissif (`*`) pour le d√©veloppement
- **Credentials** : Support√©

### **Frontend (Next.js)**
- **URL API** : `http://62.171.181.213/api`
- **Credentials** : Activ√©
- **Origin** : `http://62.171.181.213:3000`

---

*Correction appliqu√©e le : 18 Septembre 2025*
