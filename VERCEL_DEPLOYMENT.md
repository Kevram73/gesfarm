# Guide de D√©ploiement Laravel sur Vercel

## üöÄ Configuration pour Vercel

### 1. Pr√©requis
- Compte Vercel
- Base de donn√©es externe (PlanetScale, Railway, ou autre)
- Variables d'environnement configur√©es

### 2. Variables d'Environnement √† Configurer

Dans le dashboard Vercel, ajoutez ces variables :

```bash
# Application
APP_NAME=GESFARM
APP_ENV=production
APP_KEY=base64:your-generated-app-key
APP_DEBUG=false
APP_URL=https://your-app-name.vercel.app

# Base de donn√©es
DB_CONNECTION=mysql
DB_HOST=your-database-host
DB_PORT=3306
DB_DATABASE=your-database-name
DB_USERNAME=your-database-username
DB_PASSWORD=your-database-password

# Cache et sessions (optimis√©s pour serverless)
CACHE_DRIVER=array
SESSION_DRIVER=array
QUEUE_CONNECTION=sync
MAIL_MAILER=log
```

### 3. G√©n√©ration de la Cl√© d'Application

```bash
# Localement, g√©n√©rez une cl√©
php artisan key:generate --show

# Copiez la cl√© g√©n√©r√©e dans APP_KEY sur Vercel
```

### 4. Base de Donn√©es Recommand√©es

#### Option 1: PlanetScale (Gratuit)
- Cr√©ez un compte sur [PlanetScale](https://planetscale.com)
- Cr√©ez une nouvelle base de donn√©es
- Copiez les credentials dans Vercel

#### Option 2: Railway (Gratuit)
- Cr√©ez un compte sur [Railway](https://railway.app)
- Cr√©ez un service MySQL
- Copiez les credentials dans Vercel

#### Option 3: Supabase (Gratuit)
- Cr√©ez un compte sur [Supabase](https://supabase.com)
- Cr√©ez un nouveau projet
- Utilisez les credentials PostgreSQL

### 5. D√©ploiement

#### M√©thode 1: Via CLI Vercel
```bash
# Installez Vercel CLI
npm i -g vercel

# Connectez-vous
vercel login

# D√©ployez
vercel --prod
```

#### M√©thode 2: Via GitHub
1. Poussez votre code sur GitHub
2. Connectez votre repo √† Vercel
3. Configurez les variables d'environnement
4. D√©ployez

### 6. Configuration Post-D√©ploiement

#### Migrations et Seeders
```bash
# Via Vercel CLI (apr√®s d√©ploiement)
vercel env pull .env.local
php artisan migrate --force
php artisan db:seed --force
```

#### Ou via une fonction API temporaire
Cr√©ez une route temporaire pour les migrations :

```php
// routes/api.php
Route::post('/setup', function() {
    Artisan::call('migrate', ['--force' => true]);
    Artisan::call('db:seed', ['--force' => true]);
    return response()->json(['message' => 'Setup completed']);
});
```

### 7. Optimisations pour Vercel

#### Cache Configuration
```php
// config/cache.php - Ajoutez pour Vercel
'vercel' => [
    'driver' => 'array',
],
```

#### Session Configuration
```php
// config/session.php - Optimis√© pour serverless
'lifetime' => 120, // 2 heures
'expire_on_close' => true,
'encrypt' => false, // Pas de chiffrement pour les performances
```

### 8. Limitations Vercel

- **Timeout**: 30 secondes max par requ√™te
- **M√©moire**: 1024 MB max
- **Stockage**: Pas de stockage persistant
- **Queue**: Pas de workers en arri√®re-plan

### 9. Solutions pour les Limitations

#### Stockage de Fichiers
Utilisez des services externes :
- AWS S3
- Cloudinary
- Vercel Blob

#### Queue et Jobs
- Utilisez des services externes (Redis, AWS SQS)
- Ou traitez les jobs de mani√®re synchrone

#### Cache
- Utilisez Vercel KV (Redis)
- Ou cache en m√©moire (array driver)

### 10. Monitoring et Debugging

#### Logs Vercel
```bash
# Voir les logs
vercel logs

# Logs en temps r√©el
vercel logs --follow
```

#### Debugging
```php
// Dans vos contr√¥leurs, utilisez
Log::info('Debug info', $data);
```

### 11. URLs de l'API

Apr√®s d√©ploiement, votre API sera disponible √† :
- `https://your-app-name.vercel.app/api/`
- `https://your-app-name.vercel.app/sanctum/`

### 12. Mise √† Jour du Frontend

Mettez √† jour l'URL de l'API dans votre frontend :

```typescript
// lib/services/api.ts
const baseURL = "https://your-app-name.vercel.app/api"
```

## ‚úÖ Checklist de D√©ploiement

- [ ] Variables d'environnement configur√©es
- [ ] Base de donn√©es externe cr√©√©e
- [ ] Cl√© d'application g√©n√©r√©e
- [ ] Code pouss√© sur GitHub
- [ ] Projet Vercel cr√©√©
- [ ] D√©ploiement r√©ussi
- [ ] Migrations ex√©cut√©es
- [ ] API test√©e
- [ ] Frontend mis √† jour
- [ ] CORS configur√©

## üÜò D√©pannage

### Erreur 500
- V√©rifiez les logs Vercel
- V√©rifiez les variables d'environnement
- V√©rifiez la connexion √† la base de donn√©es

### Erreur CORS
- V√©rifiez la configuration CORS dans `vercel.json`
- V√©rifiez les headers dans `config/cors.php`

### Timeout
- Optimisez vos requ√™tes
- R√©duisez la complexit√© des op√©rations
- Utilisez le cache quand possible
