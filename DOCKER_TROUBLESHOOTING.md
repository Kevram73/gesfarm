# üê≥ Guide de D√©pannage Docker - GESFARM

## Probl√®mes Courants et Solutions

### 1. Erreur "COPY docker/php/local.ini not found"

**Probl√®me** : Docker ne peut pas trouver les fichiers dans le dossier `docker/`

**Solutions** :
```bash
# V√©rifier que le fichier .dockerignore n'exclut pas le dossier docker/
grep -n "docker/" .dockerignore

# Si docker/ est list√©, le commenter ou le supprimer
# docker/ - Comment√© pour permettre l'acc√®s aux fichiers de config
```

### 2. Erreur de Permissions

**Probl√®me** : Erreurs de permissions lors de la construction

**Solutions** :
```bash
# V√©rifier les permissions des fichiers
ls -la docker/php/

# Corriger les permissions si n√©cessaire
chmod +x docker/php/start.sh
chmod +x docker/scripts/*.sh
```

### 3. Erreur de Contexte Docker

**Probl√®me** : Fichiers non trouv√©s dans le contexte de construction

**Solutions** :
```bash
# V√©rifier le contexte de construction
docker build --no-cache -t gesfarm-test .

# V√©rifier que tous les fichiers sont dans le bon r√©pertoire
find . -name "*.sh" -o -name "*.ini" | grep docker
```

### 4. Erreur de Port Occup√©

**Probl√®me** : Port 80 ou 3306 d√©j√† utilis√©

**Solutions** :
```bash
# V√©rifier les ports utilis√©s
netstat -tulpn | grep :80
netstat -tulpn | grep :3306

# Arr√™ter les services qui utilisent ces ports
sudo systemctl stop apache2
sudo systemctl stop mysql
```

### 5. Erreur de M√©moire Insuffisante

**Probl√®me** : Docker manque de m√©moire

**Solutions** :
```bash
# Augmenter la m√©moire allou√©e √† Docker
# Dans Docker Desktop : Settings > Resources > Memory

# Ou r√©duire la consommation m√©moire
docker system prune -f
```

## Commandes de Diagnostic

### V√©rifier l'√âtat des Conteneurs
```bash
docker-compose ps
docker-compose logs
```

### Nettoyer Docker
```bash
# Nettoyer les images inutilis√©es
docker system prune -f

# Nettoyer tout (ATTENTION: supprime tout)
docker system prune -a -f
```

### Reconstruire Compl√®tement
```bash
# Arr√™ter et supprimer tout
docker-compose down -v

# Reconstruire sans cache
docker-compose build --no-cache

# Red√©marrer
docker-compose up -d
```

## Scripts de Test

### Test de Configuration
```bash
chmod +x test-docker.sh
./test-docker.sh
```

### D√©ploiement Complet
```bash
chmod +x deploy.sh
./deploy.sh
```

## Logs et Debugging

### Voir les Logs en Temps R√©el
```bash
docker-compose logs -f app
docker-compose logs -f nginx
docker-compose logs -f db
```

### Acc√©der au Conteneur
```bash
# Acc√©der au conteneur PHP
docker-compose exec app bash

# Acc√©der √† la base de donn√©es
docker-compose exec db mysql -u gesfarm_user -p gesfarm
```

### V√©rifier la Configuration
```bash
# Tester la configuration docker-compose
docker-compose config

# V√©rifier les variables d'environnement
docker-compose exec app env
```

## Solutions Sp√©cifiques

### Probl√®me de .dockerignore
Si le fichier `.dockerignore` exclut le dossier `docker/`, modifiez-le :

```bash
# √âditer .dockerignore
nano .dockerignore

# Commenter ou supprimer la ligne :
# docker/
```

### Probl√®me de Fichiers Manquants
V√©rifiez que tous les fichiers n√©cessaires existent :

```bash
# V√©rifier la structure
tree docker/
ls -la docker/php/
ls -la docker/nginx/
ls -la docker/scripts/
```

### Probl√®me de Permissions Windows
Sur Windows, assurez-vous que Docker Desktop a acc√®s aux dossiers :

1. Ouvrir Docker Desktop
2. Aller dans Settings > Resources > File Sharing
3. Ajouter le dossier du projet

## Support

Si les probl√®mes persistent :

1. V√©rifiez les logs : `docker-compose logs`
2. Testez la configuration : `./test-docker.sh`
3. Consultez la documentation Docker
4. Contactez l'√©quipe de support
