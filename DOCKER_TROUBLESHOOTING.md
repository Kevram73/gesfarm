# üê≥ GESFARM - Guide de D√©pannage Docker

## üö® **Erreurs Courantes et Solutions**

### **1. Erreur: `Failed to open stream: No such file or directory in /var/www/artisan`**

**Cause :** Les d√©pendances Composer ne sont pas install√©es dans le conteneur.

**Solution :**
```bash
# Arr√™ter les conteneurs
docker-compose down

# Reconstruire les images
docker-compose build --no-cache

# Red√©marrer
docker-compose up -d
```

### **2. Erreur: `mysqladmin: command not found`**

**Cause :** Le client MySQL n'est pas install√© dans le conteneur PHP.

**Solution :** ‚úÖ **CORRIG√â** - Le Dockerfile a √©t√© mis √† jour pour inclure `default-mysql-client`.

### **3. Erreur: `En attente de MySQL...` (boucle infinie)**

**Cause :** Le service queue/scheduler d√©marre avant que les d√©pendances soient install√©es.

**Solution :** ‚úÖ **CORRIG√â** - Les services queue et scheduler d√©pendent maintenant du service `app`.

---

## üõ†Ô∏è **Commandes de D√©pannage**

### **Red√©marrage Complet**
```bash
# Script automatis√©
chmod +x restart-docker.sh
./restart-docker.sh
```

### **Red√©marrage Manuel**
```bash
# Arr√™ter tous les services
docker-compose down

# Supprimer les volumes (ATTENTION: supprime les donn√©es)
docker-compose down --volumes

# Reconstruire les images
docker-compose build --no-cache

# D√©marrer les services
docker-compose up -d
```

### **V√©rification des Services**
```bash
# Statut des conteneurs
docker-compose ps

# Logs en temps r√©el
docker-compose logs -f

# Logs d'un service sp√©cifique
docker-compose logs app
docker-compose logs queue
docker-compose logs db
```

### **Acc√®s aux Conteneurs**
```bash
# Acc√©der au conteneur app
docker-compose exec app bash

# Acc√©der au conteneur de base de donn√©es
docker-compose exec db mysql -u gesfarm_user -p gesfarm

# V√©rifier les d√©pendances Composer
docker-compose exec app composer --version
docker-compose exec app ls -la vendor/
```

---

## üîß **Corrections Appliqu√©es**

### **1. Dockerfile**
- ‚úÖ Ajout de `default-mysql-client` pour `mysqladmin`
- ‚úÖ Copie du script `start-queue.sh`
- ‚úÖ Permissions correctes sur les scripts

### **2. Scripts de D√©marrage**
- ‚úÖ `start.sh` : Script principal pour le service app
- ‚úÖ `start-queue.sh` : Script simplifi√© pour queue/scheduler
- ‚úÖ V√©rification des d√©pendances avant d√©marrage

### **3. Docker Compose**
- ‚úÖ D√©pendances correctes entre services
- ‚úÖ Queue et scheduler d√©pendent du service app
- ‚úÖ Commandes de d√©marrage mises √† jour

---

## üìã **Ordre de D√©marrage Correct**

1. **Base de donn√©es** (`db`) - MySQL
2. **Cache** (`redis`) - Redis
3. **Application** (`app`) - PHP/Laravel avec installation des d√©pendances
4. **Queue** (`queue`) - Worker Laravel
5. **Scheduler** (`scheduler`) - T√¢ches cron Laravel
6. **Nginx** (`nginx`) - Serveur web
7. **Services auxiliaires** (phpMyAdmin, Mailhog)

---

## üöÄ **D√©marrage Rapide**

### **Premi√®re Installation**
```bash
# Cloner le projet
git clone <repository>
cd gesfarm

# Copier le fichier d'environnement
cp .env.example .env

# D√©marrer avec Docker
docker-compose up -d

# V√©rifier les logs
docker-compose logs -f app
```

### **Apr√®s des Modifications**
```bash
# Red√©marrage rapide
docker-compose restart

# Ou reconstruction compl√®te
./restart-docker.sh
```

---

## üîç **Diagnostic des Probl√®mes**

### **V√©rifier les Logs**
```bash
# Logs de tous les services
docker-compose logs

# Logs d'un service sp√©cifique
docker-compose logs app
docker-compose logs queue
docker-compose logs db
```

### **V√©rifier les Conteneurs**
```bash
# Statut des conteneurs
docker-compose ps

# Informations d√©taill√©es
docker-compose config
```

### **V√©rifier les Volumes**
```bash
# Lister les volumes
docker volume ls

# Inspecter un volume
docker volume inspect gesfarm_mysql_data
```

### **V√©rifier les R√©seaux**
```bash
# Lister les r√©seaux
docker network ls

# Inspecter le r√©seau
docker network inspect gesfarm_gesfarm_network
```

---

## üåê **URLs d'Acc√®s**

- **Application** : http://localhost
- **phpMyAdmin** : http://localhost:8080
- **Mailhog** : http://localhost:8025
- **API Documentation** : http://localhost/api/documentation

---

## üìû **Support**

Si les probl√®mes persistent :

1. **V√©rifier les logs** : `docker-compose logs -f`
2. **Red√©marrer compl√®tement** : `./restart-docker.sh`
3. **V√©rifier les ressources syst√®me** : RAM, espace disque
4. **Consulter la documentation Docker** : https://docs.docker.com/

---

*Derni√®re mise √† jour : 18 Septembre 2025*
